+++
title = "evm"
draft = true
date = "2016-10-09T11:27:46+09:00"

+++

# evm で emacs 25.1 を試す #

ひとつの環境に複数のバージョンの emacs を管理できる evm というツールがあるらしい。
いきなり 25.1 にするのは怖いので evm を入れてみる。

https://github.com/rejeep/evm

readme の通り入れてみた。
```
$ curl -fsSkL https://raw.github.com/rejeep/evm/master/go | bash
$ export PATH="$HOME/.evm/bin:$PATH"
```
バージョンがあるか確認する。
```
% evm list | grep 25.1
emacs-25.1
emacs-25.1-travis
```
あった。

evm はデフォルトで `/usr/local/evm` にファイルを作るようだったので設定を変更。
```
% evm config path ~/evm
% mkdir evm
% evm install emacs-25.1
```

configure で失敗するらしい。
```
checking for libXaw... configure: error: No X toolkit could be found.
If you are sure you want Emacs compiled without an X toolkit, pass
  --with-x-toolkit=no
to configure.  Otherwise, install the development libraries for the toolkit
that you want to use (e.g. Gtk+) and re-run configure.
Failed! See logs above for error.
```
この先いろんなライブラリが不足していると言われそうなのでとりあえず、 依存パッケージを落としておく。
これがいいわけではないとおもう。
```
sudo apt-get build-dep emacs24
```
うまくコンパイルできた。
バイナリで着ている。
```
$ evm bin emacs-25.1
/home/yourhome/evm/emacs-25.1/bin/emacs
```
```
$ evm use emacs-25.1
```
emacs が 25.1 で起動できるようになった。

# module を作る #

ここを参考にしてモジュールを作ってみる。
http://diobla.info/blog-archive/modules-tut.html

emacs-module.h があると便利らしい。さっき evm に入って中に含まれるのでこれをつかう。
```
$ cp /home/yourhome/evm/tmp/emacs-25.1/src/emacs-module.h ~/include/
```

```
$ gcc -I ~/include/ -fPIC -c yomogimod.c && gcc -shared -o yomogimod.so yomogimod.o && rm yomogimod.o
$ emacs -Q
```

```
(setq load-path (cons "/home/yomogi/Programs/sandbox/20161009/" load-path)
(require 'yomogimod)
yomogimod
(plusone 3)
4
```

なぜか、 `load-path` の先頭にパスを入れないと動かない。 TODO
C のソースについてよく調べて追記 TODO

# 英語を読む #

firefox のがうまく動かないので、結局 chrome の weblio プラグインにした
